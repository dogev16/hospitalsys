{% extends "base.html" %}

{% block title %}è—¥å“æ•ˆæœŸç®¡ç†{% endblock %}

{% block content %}
<div class="page-shell">

  <!-- é é¢æ¨™é¡Œ -->
  <div class="page-header">
    <div>
      <h1 class="page-title">è—¥å“æ•ˆæœŸç®¡ç†</h1>
      <p class="page-subtitle">
        ä»Šå¤©æ—¥æœŸï¼š{{ today|date:"Y-m-d" }}
        <span class="separator-dot"></span>
        é¡¯ç¤ºæ‰€æœ‰å·²éæœŸèˆ‡ {{ warning_days }} å¤©å…§å³å°‡åˆ°æœŸçš„æ‰¹æ¬¡å–µã€‚
      </p>
    </div>

    <div class="toolbar-actions">
      <a href="{% url 'inventory:drug_list' %}" class="btn btn-outline btn-sm">
        è¿”å›è—¥å“æ¸…å–®
      </a>
    </div>
  </div>

  <!-- ç³»çµ±è¨Šæ¯ï¼ˆmessagesï¼‰ -->
  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-2">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- ğŸ”´ å·²éæœŸæ‰¹æ¬¡ -->
  <div class="card mb-4">
    <div class="card-header card-header-flex">
      <div class="card-title-sm">
        å·²éæœŸæ‰¹æ¬¡ï¼ˆä¸å¾—å†ç™¼è—¥ï¼‰
      </div>
      <div class="card-meta text-xs text-muted">
        åªé¡¯ç¤ºã€Œæ•ˆæœŸ < ä»Šå¤©ã€ä¸”ã€Œå°šæœ‰åº«å­˜ã€çš„æ‰¹æ¬¡å–µã€‚
      </div>
    </div>

    <div class="card-body">
      {% if expired_batches %}
        <div class="table-container">
          <table class="table table-hospital">
            <thead>
              <tr>
                <th style="width: 140px;">è—¥å“ä»£ç¢¼</th>
                <th>è—¥å“åç¨±</th>
                <th style="width: 120px;">æ‰¹è™Ÿ</th>
                <th style="width: 120px;">æ•ˆæœŸ</th>
                <th style="width: 110px;">å‰©é¤˜åº«å­˜</th>
                <th style="width: 180px;">å»ºè­°è™•ç†</th>
              </tr>
            </thead>
            <tbody>
              {% for b in expired_batches %}
                <tr class="row-expired">
                  <td>{{ b.drug.code }}</td>
                  <td>{{ b.drug.name }}</td>
                  <td>{{ b.batch_no|default:"-" }}</td>
                  <td>{{ b.expiry_date|date:"Y-m-d" }}</td>
                  <td>{{ b.quantity }}</td>
                  <td>
                    <span class="badge-status badge-status-danger">å·²éæœŸ</span>
                    <span class="text-muted-small d-block">
                      å»ºè­°ï¼šåœæ­¢ç™¼è—¥ã€æ¨™è¨˜å ±å»¢æˆ–é€€è²¨å–µã€‚
                    </span>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted-small mb-0">
          ç›®å‰æ²’æœ‰å·²éæœŸä¸”å°šæœ‰åº«å­˜çš„æ‰¹æ¬¡å–µï¼Œå¤ªæ£’äº†å–µï¼
        </p>
      {% endif %}
    </div>
  </div>

  <!-- ğŸŸ¡ å³å°‡åˆ°æœŸæ‰¹æ¬¡ -->
  <div class="card mb-4">
    <div class="card-header card-header-flex">
      <div class="card-title-sm">
        {{ warning_days }} å¤©å…§å³å°‡åˆ°æœŸçš„æ‰¹æ¬¡
      </div>
      <div class="card-meta text-xs text-muted">
        å”åŠ©è—¥å¸«å„ªå…ˆç™¼è—¥èˆ‡æ§ç®¡é€²è²¨ç¯€å¥å–µã€‚
      </div>
    </div>

    <div class="card-body">
      {% if near_expiry_batches %}
        <div class="table-container">
          <table class="table table-hospital">
            <thead>
              <tr>
                <th style="width: 140px;">è—¥å“ä»£ç¢¼</th>
                <th>è—¥å“åç¨±</th>
                <th style="width: 120px;">æ‰¹è™Ÿ</th>
                <th style="width: 120px;">æ•ˆæœŸ</th>
                <th style="width: 110px;">å‰©é¤˜åº«å­˜</th>
                <th style="width: 180px;">æé†’</th>
              </tr>
            </thead>
            <tbody>
              {% for b in near_expiry_batches %}
                <tr class="row-warning">
                  <td>{{ b.drug.code }}</td>
                  <td>{{ b.drug.name }}</td>
                  <td>{{ b.batch_no|default:"-" }}</td>
                  <td>{{ b.expiry_date|date:"Y-m-d" }}</td>
                  <td>{{ b.quantity }}</td>
                  <td>
                    <span class="badge-status badge-status-warning">å³å°‡åˆ°æœŸ</span>
                    <span class="text-muted-small d-block">
                      å»ºè­°ï¼šå„ªå…ˆç™¼è—¥ã€è©•ä¼°æ˜¯å¦æ¸›å°‘é€²è²¨å–µã€‚
                    </span>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted-small mb-0">
          ç›®å‰æ²’æœ‰ {{ warning_days }} å¤©å…§å³å°‡åˆ°æœŸçš„åº«å­˜å–µã€‚
        </p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
