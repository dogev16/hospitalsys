{% extends "base.html" %}
{% block title %}å…§éƒ¨ç™»å…¥{% endblock %}

{% block content %}
<div class="app-container">
  <div class="app-card" style="max-width:520px; margin: 36px auto; padding: 18px;">
    <div class="app-section-title">å…§éƒ¨ç³»çµ±ç™»å…¥</div>
    <div class="app-section-help">é™æˆæ¬Šäººå“¡ä½¿ç”¨ï¼ˆç®¡ç†å“¡ / é†«å¸« / æ«ƒå° / è—¥å¸«ï¼‰</div>

    {% if form.errors %}
      <div class="app-alert app-alert-danger" style="margin-top:12px;">
        <div style="font-weight:700; margin-bottom:6px;">ç™»å…¥å¤±æ•—</div>

        {# éæ¬„ä½éŒ¯èª¤ï¼šå¸³å¯†ä¸å°ã€äººæ©Ÿé©—è­‰ä¸å°å¸¸æœƒå‡ºç¾åœ¨é€™è£¡ #}
        {% if form.non_field_errors %}
          {% for e in form.non_field_errors %}
            <div>{{ e }}</div>
          {% endfor %}
        {% else %}
          <div>å¸³è™Ÿæˆ–å¯†ç¢¼å¯èƒ½è¼¸å…¥éŒ¯èª¤ã€‚</div>
        {% endif %}

        {# æ¬„ä½éŒ¯èª¤ï¼šä¿éšªèµ·è¦‹ä¹Ÿé¡¯ç¤º captcha æ¬„ä½éŒ¯èª¤ #}
        {% if form.captcha.errors %}
          {% for e in form.captcha.errors %}
            <div>{{ e }}</div>
          {% endfor %}
        {% endif %}
      </div>
    {% endif %}

    <form method="post" style="margin-top:14px;">
      {% csrf_token %}

      <div class="app-form-grid">
        <div class="app-form-field">
          <label class="app-label" for="id_username">å¸³è™Ÿ</label>
          <input
            id="id_username"
            name="username"
            type="text"
            class="app-input"
            autocomplete="username"
            placeholder="è¼¸å…¥å¸³è™Ÿ"
            value="{{ form.username.value|default_if_none:'' }}"
            required
          >
        </div>

        <div class="app-form-field">
          <label class="app-label" for="id_password">å¯†ç¢¼</label>

          <div class="app-input-group">
            <input
              id="id_password"
              name="password"
              type="password"
              class="app-input"
              autocomplete="current-password"
              placeholder="è¼¸å…¥å¯†ç¢¼"
              required
            >
            <button
              type="button"
              class="app-btn app-btn-secondary"
              id="togglePassword"
              style="padding:8px 10px; min-width: 42px;"
              aria-label="é¡¯ç¤ºæˆ–éš±è—å¯†ç¢¼"
              title="é¡¯ç¤º/éš±è—"
            >ğŸ‘ï¸</button>
          </div>

          <div id="capsWarning" class="app-muted" style="display:none; margin-top:6px;">
            âš ï¸ CapsLock å·²é–‹å•Ÿ
          </div>
        </div>

        {# Simple Captchaï¼ˆä½ èªªåªè¦ A å°±å¥½ï¼Œæ‰€ä»¥ä¿ç•™å¾ˆè¼•é‡ï¼‰ #}
        <div class="app-form-field">
          <label class="app-label" for="id_captcha">äººæ©Ÿé©—è­‰</label>

          <div class="app-muted" style="margin-bottom:8px;">
            é¡Œç›®ï¼š<strong>{{ request.session.login_captcha_question }}</strong>
          </div>

          <input
            id="id_captcha"
            name="captcha"
            type="text"
            inputmode="numeric"
            class="app-input"
            placeholder="è¼¸å…¥ç­”æ¡ˆ"
            value="{{ form.captcha.value|default_if_none:'' }}"
            required
          >
          <div class="app-muted" style="margin-top:6px;">ï¼ˆè¼¸å…¥ä¸Šé¢ç®—å¼ç­”æ¡ˆï¼‰</div>
        </div>
      </div>

      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
        <a class="app-btn app-btn-secondary" href="/">è¿”å›å¤–éƒ¨ç¶²ç«™</a>
        <button class="app-btn app-btn-primary" type="submit">ç™»å…¥</button>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const pwd = document.getElementById("id_password");
  const toggle = document.getElementById("togglePassword");
  const capsWarning = document.getElementById("capsWarning");

  if (toggle && pwd) {
    toggle.addEventListener("click", function () {
      const isPwd = pwd.type === "password";
      pwd.type = isPwd ? "text" : "password";
      toggle.textContent = isPwd ? "ğŸ™ˆ" : "ğŸ‘ï¸";
    });

    const checkCaps = (event) => {
      const on = event.getModifierState && event.getModifierState("CapsLock");
      capsWarning.style.display = on ? "block" : "none";
    };
    pwd.addEventListener("keyup", checkCaps);
    pwd.addEventListener("keydown", checkCaps);
  }
});
</script>
{% endblock %}
