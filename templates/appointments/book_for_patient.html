{% extends "base.html" %}

{% block title %}替病人掛號喵{% endblock %}

{% block content %}
<h1>替 {{ patient.full_name }} 掛號喵</h1>

<p>
  病歷號：{{ patient.chart_no }}　
  身分證：{{ patient.national_id }}
</p>

{% if messages %}
  <ul style="color: red;">
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}

<form method="post">
  {% csrf_token %}
  <table>
    <tr>
      <th>病歷號</th>
      <td>{{ patient.chart_no }}</td>
    </tr>
    <tr>
      <th>{{ form.doctor.label_tag }}</th>
      <td>{{ form.doctor }}</td>
    </tr>
    <tr>
      <th>{{ form.appt_date.label_tag }}</th>
      <td>{{ form.appt_date }}</td>
    </tr>
    <tr>
      <th>{{ form.appt_time.label_tag }}</th>
      <td>
        {{ form.appt_time }}
        {% if not slots %}
          <div style="font-size: 0.9em; color: #666;">
            請先選擇醫師與日期，按「載入可約時段」後才會出現可選時間喵。
          </div>
        {% endif %}
      </td>
    </tr>
  </table>

  <button type="submit" name="action" value="load_slots">
    載入可約時段
  </button>

  <button type="submit" name="action" value="confirm">
    確認掛號喵
  </button>
</form>

{% if slots %}
  <h3>本次載入的可掛號時段喵</h3>
  <ul>
    {% for t in slots %}
      <li>{{ t|time:"H:i" }}</li>
    {% endfor %}
  </ul>
{% endif %}

<p>
  <a href="{% url 'patients:patient_detail' patient.id %}">← 回病人詳細資料喵</a>
</p>
{% endblock %}
